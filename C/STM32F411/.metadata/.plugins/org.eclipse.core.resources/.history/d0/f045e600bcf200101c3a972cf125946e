/* USER CODE BEGIN Header */
/**
  ******************************************************************************
  * @file           : main.h
  * @brief          : Header for main.c file (Based on Working Version)
  ******************************************************************************
  */
/* USER CODE END Header */

/* Define to prevent recursive inclusion -------------------------------------*/
#ifndef __MAIN_H
#define __MAIN_H

#ifdef __cplusplus
extern "C" {
#endif

/* Includes ------------------------------------------------------------------*/
#include "stm32f4xx_hal.h"
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <stdbool.h>

// Giữ nguyên thư viện gốc của bạn
#include "dwt.h"
#include "dhtxx.h"
#include "i2c_lcd.h"

/* ============================================================================== */
/* CẤU HÌNH (CONFIGURATION)                                                       */
/* ============================================================================== */
#define DEVICE_NODE_ID  "NODE_01"
#define WIFI_SSID       "Herukyatto"
#define WIFI_PASSWORD   "123456789"
#define SERVER_IP       "192.168.137.103" // IP Jetson
#define SERVER_PORT     5000
#define SEND_INTERVAL   3000 // Gửi mỗi 3 giây (Cho nhanh thấy)

// Ngưỡng báo cháy
#define GAS_THRESHOLD   2000
#define TEMP_THRESHOLD  50.0

/* Pin Definitions (Giữ nguyên gốc) */
#define MQ2_Pin GPIO_PIN_0
#define MQ2_Port GPIOA
#define MQ135_Pin GPIO_PIN_1
#define MQ135_Port GPIOA
#define PIR_Pin GPIO_PIN_4
#define PIR_Port GPIOA
#define DHT_Pin GPIO_PIN_5
#define DHT_Port GPIOA

#define RELAY1_Pin GPIO_PIN_11
#define RELAY1_Port GPIOA
#define RELAY2_Pin GPIO_PIN_12
#define RELAY2_Port GPIOA
#define RELAY3_Pin GPIO_PIN_15
#define RELAY3_Port GPIOA

// Buzzer Test (PA10)
#define BUZZER_TEST_Pin GPIO_PIN_10
#define BUZZER_TEST_Port GPIOA

// Debug LCD (Tắt)
#define ON          1
#define OFF         0
#define DEBUG_LCD   OFF

// ADC Channels
#define ADC_CHAN_MQ2    ADC_CHANNEL_0
#define ADC_CHAN_MQ135  ADC_CHANNEL_1

/* ============================================================================== */
/* PROTOTYPES                                                                    */
/* ============================================================================== */
void Error_Handler(void);
void SystemClock_Config(void);

// Utils
void annouce_buzzer(int timeout);
void relaytest(uint32_t timeout, int relay_id);
int Read_ADC_Channel(uint32_t channel);

// Core Wifi
bool AT_Send_And_Wait(char* cmd, char* target_response, uint32_t timeout);
void WiFi_Connect_Polling(void);

#ifdef __cplusplus
}
#endif

#endif /* __MAIN_H */
