/* USER CODE BEGIN Header */
/**
  ******************************************************************************
  * @file           : main.h
  * @brief          : Header for main.c file (Unified Declarations)
  ******************************************************************************
  */
/* USER CODE END Header */

/* Define to prevent recursive inclusion -------------------------------------*/
#ifndef __MAIN_H
#define __MAIN_H

#ifdef __cplusplus
extern "C" {
#endif

/*Includes ------------------------------------------------------------------*/
#include "stm32f4xx_hal.h"
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <stdbool.h>

/* ============================================================================== */
/* 1. CẤU HÌNH HỆ THỐNG & MẠNG                                                   */
/* ============================================================================== */
#define DEVICE_NODE_ID  "NODE_01"
#define WIFI_SSID       "Herukyatto"
#define WIFI_PASSWORD   "123456789"

// IP Server Backend/Gateway
#define SERVER_IP       "192.168.137.103"
#define SERVER_PORT     5000
#define UPLINK_INTERVAL 3000

/* ============================================================================== */
/* 2. CẤU HÌNH NGƯỠNG CẢM BIẾN (ALARM)                                           */
/* ============================================================================== */
#define GAS_THRESHOLD   2000
#define TEMP_THRESHOLD  50.0

/* ============================================================================== */
/* 3. ĐỊNH NGHĨA PIN (HARDWARE MAPPING)                                          */
/* ============================================================================== */
// --- INPUT (SENSORS) ---
#define MQ2_Pin         GPIO_PIN_0
#define MQ2_Port        GPIOA
#define MQ135_Pin       GPIO_PIN_1
#define MQ135_Port      GPIOA
#define PIR_Pin         GPIO_PIN_4
#define PIR_Port        GPIOA
#define DHT_Pin         GPIO_PIN_5
#define DHT_Port        GPIOA

// --- OUTPUT (ACTUATORS) ---
#define BUZZER_TEST_Pin GPIO_PIN_10
#define BUZZER_TEST_Port GPIOA
#define LED_TEST_Pin    GPIO_PIN_9
#define LED_TEST_Port   GPIOA

// --- RELAYS ---
#define RELAY1_Pin      GPIO_PIN_11
#define RELAY1_Port     GPIOA
#define RELAY2_Pin      GPIO_PIN_12
#define RELAY2_Port     GPIOA
#define RELAY3_Pin      GPIO_PIN_15
#define RELAY3_Port     GPIOA

// --- ADC CHANNELS ---
#define ADC_CHAN_MQ2    ADC_CHANNEL_0
#define ADC_CHAN_MQ135  ADC_CHANNEL_1

/* ============================================================================== */
/* 4. BIẾN TOÀN CỤC (EXTERN)                                                     */
/* ============================================================================== */
extern ADC_HandleTypeDef hadc1;
extern UART_HandleTypeDef huart6;

// Biến cảm biến dùng chung
extern float temp;
extern float hum;
extern int gas_mq2;
extern int gas_mq135;
extern int motion;

/* ============================================================================== */
/* 5. KHAI BÁO HÀM (PROTOTYPES)                                                  */
/* ============================================================================== */
// Hàm hệ thống (System)
void Error_Handler(void);
void SystemClock_Config(void);

// Hàm tiện ích (Utils)
void annouce_buzzer(int timeout);
void relaytest(uint32_t timeout, int relay_id);
int Read_ADC_Channel(uint32_t channel);

// Hàm Wifi & ESP (Core Logic)
bool ESP_Polling_Send(char *cmd, char *target_response, int timeout_ms);
void WiFi_Connect_Polling(void); // Đã sửa thành void để khớp với logic while(1)

#ifdef __cplusplus
}
#endif

#endif /* __MAIN_H */
